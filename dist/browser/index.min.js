var frtjs=function(){"use strict";function t(t,n,e,s){return new(e||(e=Promise))((function(r,o){function i(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(i,a)}c((s=s.apply(t,n||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const n="frtjs",e="1.0.0";var s,r;!function(t){t.PV="pv",t.PERF="perf",t.API="api",t.ERROR="error",t.CUSTOM="custom"}(s||(s={})),function(t){t.XHR="xhr",t.FETCH="fetch",t.JS="js",t.DOM="dom",t.RESOURCE="resource",t.UNHANDLEDREJECTION="unhandledrejection",t.ROUTER="router"}(r||(r={}));const o=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i;function i(t){const n=t.match(o);if(!n)return{};return{filename:n[2],functionName:n[1]||"",lineno:parseInt(n[3],10)||void 0,colno:parseInt(n[4],10)||void 0}}function a(t,n=10){const{stack:e}=t;if(!e)return[];const s=[];for(const t of e.split("\n").slice(1)){const n=i(t);n&&s.push(n)}return s.slice(0,n)}const c=t=>t instanceof ErrorEvent,u=t=>t.split("").reduce((function(t,n){return(t=(t<<5)-t+n.charCodeAt(0))&t}),0),d=()=>(new Date).valueOf();class p{constructor(t={}){var s;this.SDK_NAME=n,this.SDK_VERSION=e,this.options=Object.assign({maxBreadcrumbs:20},t),this._subscribe={all:s=s||new Map,on:function(t,n){var e=s.get(t);e?e.push(n):s.set(t,[n])},off:function(t,n){var e=s.get(t);e&&(n?e.splice(e.indexOf(n)>>>0,1):s.set(t,[]))},emit:function(t,n){var e=s.get(t);e&&e.slice().map((function(t){t(n)})),(e=s.get("*"))&&e.slice().map((function(e){e(t,n)}))}},this.breadcrumbs=[]}use(t){t.trace.call(this,this._subscribe.emit.bind(this,t.name));return this._subscribe.on(t.name,((...n)=>{var e,s;const r=null===(e=t.transform)||void 0===e?void 0:e.apply(this,n);null===(s=t.post)||void 0===s||s.call(this,r)})),this}pushBreadCrumbs(n){return t(this,void 0,void 0,(function*(){this.breadcrumbs.push(n),this.breadcrumbs.length>=this.options.maxBreadcrumbs&&(this.transport.send(s.API,[...this.breadcrumbs]).then(),this.breadcrumbs.length=0)}))}getOptions(){return this.options}}class l{constructor(t){this.client=t}send(s,r){return t(this,void 0,void 0,(function*(){if(!this.client.options.dsn)return;const t=yield this.client.options.getAuthInfo(),o=Object.assign(Object.assign({},t),{category:s,sdkName:n,sdkVersion:e});return Array.isArray(r)?o.contexts=r:o.context=r,this.sendToServer(o)}))}}class f extends l{constructor(t){super(t)}sendToServer(t){("function"==typeof navigator.sendBeacon?this.sendByBeacon():this.sendByXml())(t)}sendByXml(){return t=>{const n=new window.oXMLHttpRequest;n.setRequestHeader("Content-Type","application/json"),n.open("POST",this.client.options.dsn,!0),n.send(JSON.stringify(t))}}sendByBeacon(){return t=>{window.navigator.sendBeacon(this.client.options.dsn,new Blob([JSON.stringify(t)],{type:"application/json"}))||this.sendByXml().apply(this,[t])}}}class h extends p{constructor(t){super(t),this.transport=new f(this)}send(t){console.log(t)}}const m={name:r.JS,trace(t){window&&window.addEventListener("error",(n=>{var e,s,o,i,p,l;if(!c(n))return;const f=a(n.error),h={filename:null!==(s=null===(e=f[0])||void 0===e?void 0:e.filename)&&void 0!==s?s:"",errorType:n.error.name,position:(null===(o=f[0])||void 0===o?void 0:o.lineno)+":"+(null===(i=f[0])||void 0===i?void 0:i.colno),stack:JSON.stringify(f),traceId:"",url:window.location.href,timestamp:d().toString(),userAgent:navigator.userAgent,type:r.JS,message:n.error.message,functionName:null!==(l=null===(p=f[0])||void 0===p?void 0:p.functionName)&&void 0!==l?l:""};h.traceId=(t=>u([t.filename,t.functionName,t.position].join(",")).toString())(h),t(h)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(s.ERROR,t)}},g={name:r.RESOURCE,trace(t){window&&window.addEventListener("error",(n=>{if(!(t=>!c(t))(n))return;const e=n.target,s={filename:e.href||e.src,message:"",tagName:e.tagName,timestamp:d().toString(),traceId:"",type:r.RESOURCE,url:window.location.href,userAgent:navigator.userAgent,outerHTML:e.outerHTML};s.traceId=(t=>u([t.type,t.filename,t.tagName].join(",")).toString())(s),t(s)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(s.ERROR,t)}},w={name:r.XHR,trace(t){const n=this;if("XMLHttpRequest"in window&&"function"==typeof window.XMLHttpRequest){const e=window.XMLHttpRequest;window.oXMLHttpRequest||(window.oXMLHttpRequest=e),window.XMLHttpRequest=function(){const s=new e,{open:o,send:i}=s,a={body:"",duration:"",message:"",method:"",response:"",status:"",timestamp:d().toString(),traceId:"",xhrUrl:"",type:r.XHR,url:window.location.href,userAgent:navigator.userAgent};return s.open=(t,n)=>{a.method=t,a.xhrUrl=n.toString(),o.call(s,t,n,!0)},s.send=t=>{a.body=("string"==typeof t?t:JSON.stringify(t))||"",i.call(s,t)},s.addEventListener("loadend",(()=>{const{status:e,response:r}=s;a.status=e.toString(),a.response=JSON.stringify(r),a.traceId=(t=>u([t.type,t.method,t.xhrUrl].join(",")).toString())(a),200!==e?t(a):n.pushBreadCrumbs(a)})),s}}},transform:t=>Object.assign({},t),post(t){this.transport.send(s.ERROR,t)}},v={name:r.UNHANDLEDREJECTION,trace(t){window&&window.addEventListener("unhandledrejection",(n=>{const e={errorType:n.reason.name||"unKnown",message:n.reason.message||n.reason,stack:JSON.stringify(a(n.reason)),timestamp:d().toString(),traceId:"",type:r.UNHANDLEDREJECTION,url:window.location.href,userAgent:navigator.userAgent};e.traceId=(t=>u([t.type,t.message,t.errorType].join(",")).toString())(e),t(e)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(s.ERROR,t)}};return{init:t=>{const n=new h(t);return n.use(m).use(g).use(w).use(v),n}}}();
//# sourceMappingURL=index.min.js.map
