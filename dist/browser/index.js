"use strict";const t="frtjs",n="1.0.0";var e,o;!function(t){t.PV="pv",t.PERF="perf",t.API="api",t.ERROR="error",t.CUSTOM="custom"}(e||(e={})),function(t){t.XHR="xhr",t.FETCH="fetch",t.JS_ERROR="jsError",t.DOM="dom",t.RES_ERROR="resourceError",t.UNHANDLEDREJECTION="unhandledrejection",t.ROUTER="router"}(o||(o={}));const s=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i;function r(t){const n=t.match(s);if(!n)return{};return{filename:n[2],functionName:n[1]||"",lineno:parseInt(n[3],10)||void 0,colno:parseInt(n[4],10)||void 0}}function i(t,n=10){const{stack:e}=t;if(!e)return[];const o=[];for(const t of e.split("\n").slice(1)){const n=r(t);n&&o.push(n)}return o.slice(0,n)}const a=t=>t instanceof ErrorEvent,c=t=>t.split("").reduce((function(t,n){return(t=(t<<5)-t+n.charCodeAt(0))&t}),0),u=()=>(new Date).valueOf();class d{constructor(e){var o;this.SDK_NAME=t,this.SDK_VERSION=n,this.options=e,this._subscribe={all:o=o||new Map,on:function(t,n){var e=o.get(t);e?e.push(n):o.set(t,[n])},off:function(t,n){var e=o.get(t);e&&(n?e.splice(e.indexOf(n)>>>0,1):o.set(t,[]))},emit:function(t,n){var e=o.get(t);e&&e.slice().map((function(t){t(n)})),(e=o.get("*"))&&e.slice().map((function(e){e(t,n)}))}}}use(t){t.trace.call(this,this._subscribe.emit.bind(this,t.name));return this._subscribe.on(t.name,((...n)=>{var e,o;const s=null===(e=t.transform)||void 0===e?void 0:e.apply(this,n);null===(o=t.post)||void 0===o||o.call(this,s)})),this}getOptions(){return this.options}}function l(t,n,e,o){return new(e||(e=Promise))((function(s,r){function i(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var n;t.done?s(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(i,a)}c((o=o.apply(t,n||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class p{constructor(t){this.options=t}send(e,o){return l(this,void 0,void 0,(function*(){if(!this.options.dsn)return;const s=yield this.options.getAuthInfo(),r=Object.assign(Object.assign({},s),{category:e,sdkName:t,sdkVersion:n});return Array.isArray(o)?r.contexts=o:r.context=o,this.sendToServer(r)}))}}class f extends p{constructor(t){super(t)}sendToServer(t){("function"==typeof navigator.sendBeacon?this.sendByBeacon():this.sendByXml())(t)}sendByXml(){return t=>{console.log(123);const n=new window.oXMLHttpRequest;n.setRequestHeader("Content-Type","application/json"),n.open("POST",this.options.dsn,!0),n.send(JSON.stringify(t))}}sendByBeacon(){return t=>{const n=window.navigator.sendBeacon(this.options.dsn,new Blob([JSON.stringify(t)],{type:"application/json"}));console.log("Beacon status",n),n||this.sendByXml().apply(this,[t])}}}class m extends d{constructor(t){super(t),this.transport=new f(t)}send(t){console.log(t)}}const g={name:o.JS_ERROR,trace(t){window&&window.addEventListener("error",(n=>{var e,s,r,d,l,p;if(!a(n))return;const f=i(n.error),m={filename:null!==(s=null===(e=f[0])||void 0===e?void 0:e.filename)&&void 0!==s?s:"",errorType:n.error.name,position:(null===(r=f[0])||void 0===r?void 0:r.lineno)+":"+(null===(d=f[0])||void 0===d?void 0:d.colno),stack:JSON.stringify(f),traceId:"",url:window.location.href,timestamp:u().toString(),userAgent:navigator.userAgent,type:o.JS_ERROR,message:n.error.message,functionName:null!==(p=null===(l=f[0])||void 0===l?void 0:l.functionName)&&void 0!==p?p:""};m.traceId=(t=>c([t.filename,t.functionName,t.position].join(",")).toString())(m),t(m)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(e.ERROR,t)}},h={name:o.RES_ERROR,trace(t){window&&window.addEventListener("error",(n=>{if(!(t=>!a(t))(n))return;const e=n.target,s={filename:e.href||e.src,message:"",tagName:e.tagName,timestamp:u().toString(),traceId:"",type:o.RES_ERROR,url:window.location.href,userAgent:navigator.userAgent,outerHTML:e.outerHTML};s.traceId=(t=>c([t.type,t.filename,t.tagName].join(",")).toString())(s),t(s)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(e.ERROR,t)}},R={name:o.XHR,trace(t){if("XMLHttpRequest"in window&&"function"==typeof window.XMLHttpRequest){const n=window.XMLHttpRequest;window.oXMLHttpRequest||(window.oXMLHttpRequest=n),window.XMLHttpRequest=function(){const e=new n,{open:s,send:r}=e,i={body:"",duration:"",message:"",method:"",response:"",status:"",timestamp:u().toString(),traceId:"",xhrUrl:"",type:o.XHR,url:window.location.href,userAgent:navigator.userAgent};return e.open=(t,n)=>{i.method=t,i.xhrUrl=n.toString(),s.call(e,t,n,!0)},e.send=t=>{i.body=("string"==typeof t?t:JSON.stringify(t))||"",r.call(e,t)},e.addEventListener("loadend",(()=>{const{status:n,response:o}=e;i.status=n.toString(),i.response=JSON.stringify(o),i.traceId=(t=>c([t.type,t.method,t.xhrUrl].join(",")).toString())(i),200!==n&&t(i)})),e}}},transform:t=>Object.assign({},t),post(t){this.transport.send(e.ERROR,t)}},w={name:o.UNHANDLEDREJECTION,trace(t){window&&window.addEventListener("unhandledrejection",(n=>{const e={errorType:n.reason.name||"unKnown",message:n.reason.message||n.reason,stack:JSON.stringify(i(n.reason)),timestamp:u().toString(),traceId:"",type:o.UNHANDLEDREJECTION,url:window.location.href,userAgent:navigator.userAgent};e.traceId=(t=>c([t.type,t.message,t.errorType].join(",")).toString())(e),t(e)}),!0)},transform:t=>Object.assign({},t),post(t){this.transport.send(e.ERROR,t)}},v={init:t=>{const n=new m(t);return n.use(g).use(h).use(R).use(w),n}};module.exports=v;
//# sourceMappingURL=index.js.map
